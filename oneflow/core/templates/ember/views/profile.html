{% load markdown_deux_tags %}

{%captureas next_url %}?next={% absolute "home" %}#/profile{% endcaptureas %}

{% handlebars "profile" %}
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span10">&nbsp;</div>
    </div>
    <div class="row-fluid">
      <div class="span10 offset1" id="profile">
        <div class="row-fluid">
          <div class="span5">
            <h1>{% trans "Your profile" %}</h1>

            <table  class="table table-hover">
                <tr>
                  <td>{% trans "username" %}</td>
                  <td>@{% ember username %}</td>
                </tr>
                <tr>
                  <td>{% trans "Full name" %}</td>
                  <td>{% ember first_name %} {% ember last_name %}</td>
                </tr>
                <tr>
                  <td>{% trans "e-mail announcements" %}</td>
                  <td>{% ember email_announcements %}</td>
                </tr>
                <tr>
                  <td>{% trans "Last login: " %}</td>
                  <td>{% ember momentFromNow last_login %}</td>
                </tr>
                <tr>
                  <td>{% trans "Registered: " %}</td>
                  <td>{% ember momentFromNow date_joined %}</td>
                </tr>
            </table>

            <p class="muted">{% trans "Profile data it not yet editable." %}</p>

          </div>
          <div class="span5 offset2">
            <h1>{% trans "Social accounts" %}</h1>

            {% if social_auth.associated %}

              <h3>{% trans "Currently associated" %}
              </h3>
              <p class="muted small">
                  {% if social_count > 1 %}
                    {% filter markdown %}{% blocktrans %}
Click to disassociate any of your accounts, but beware:
if it's the account you're signed in, you will be
immediately disconnected from **1flow**.
{% endblocktrans %}{% endfilter %}
                  {% else %}
                    {% filter markdown %}{% blocktrans %}
As you have currently only one social account, you cannot de-associate it
from **1flow**: this would leave you lost in cyberspace without any way to
find back the spaceport.
{% endblocktrans %}{% endfilter %}

                  {% endif %}
              </p>

              <ul class="social-auth">
                {% for backend in social_auth.associated %}
                  {% if backend.provider == "google-oauth2" %}
                    {% captureas backend_name %}Google{% endcaptureas %}
                    {% captureas backend_full_name %}{{backend|slice:'-6'}}{% endcaptureas %}

                  {% else %}
                    {% captureas backend_name %}{{ backend.name }}{% endcaptureas %}
                    {% captureas backend_full_name %}{{backend}}{% endcaptureas %}

                  {% endif %}

                  {% if social_count == 1 %}
                    <li><a class="btn btn-block btn-huge" href="#" disabled="disabled"
                      title="{% blocktrans %}Cannot disconnect from {{ backend_name }}{% endblocktrans %}"
                      ><i class="icon-signout"></i> {{backend_full_name|title}}</a></li>

                    {% else %}
                      <li><a class="btn btn-block btn-huge"
                        href="{% url "socialauth_disconnect_individual" backend.provider backend.id %}{{next_url}}"
                        title="{% blocktrans %}Disconnect from {{ backend_name }}{% endblocktrans %}"
                        ><i class="icon-signout"></i> {{backend_full_name|title}}</a></li>

                    {% endif %}

                {% endfor %}
              </ul>

              <div class="spacer50"></div>

              <h3>{% trans "Associate more accounts" %}</h3>
            {% else %}
              <h3>{% trans "Associate accounts" %}</h3>

            {% endif %}

            {% include "snippets/social-auth-signin.html" %}

          </div>
        </div>
      </div>
    </div>
  </div>
{% endhandlebars %}
