{% extends 'base.html' %}
{% load raven django_select2_tags %}

{% block body_id %}home{% endblock body_id %}

{% block title %}{% trans 'Home' %}{% endblock title %}

{% block extrajs_header %}
    <link rel="stylesheet" type="text/css"
        href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" />

    <link rel="stylesheet" type="text/css"
        href="http://cdn.jsdelivr.net/pnotify/1.2/jquery.pnotify.default.css" />

    {% comment %}
        <link rel="stylesheet" type="text/css"
            href="http://fonts.googleapis.com/css?family=Bitter:300,400" />

        <link rel="stylesheet" type="text/css"
            href="http://fonts.googleapis.com/css?family=Lato:300,400" />

        <!-- ,700,900,300italic,400italic,700italic,900italic -->
    {% endcomment %}

    {# TODO: include this in PIPELINE #}
    {% import_django_select2_css %}

    {% compressed_css 'core-bootstrap-detail' %}
{% endblock extrajs_header %}

{% block body %}
    {#{% cache 86400 base_body_includes %}#}
        {% include 'snippets/navbar.html' %}
        {% include 'snippets/help-arrows.html' %}
    {#{% endcache %}#}

  {% block application_header %}{% endblock application_header %}

  <section class="container-fluid">
    {# <div id="notifications" class="row-fluid hide"></div> #}

    {% if messages %}
        <script type="text/javascript">
            $(document).ready(function(){

            {% for message in messages %}
                {% with message.tags as tags %}

                    notify({
                        text: {% if 'safe' in tags %}"{{ message|safe }}"{% else %}"{{ message }}"{% endif %},
                        type: {% if 'warning' in tags %}"warning"{% else %}"info"{% endif %},
                        icon: false,
                        sticker: {% if 'sticky' in tags %}true{% else %}false{% endif %}
                    });

                {% endwith %}
            {% endfor %}

            });
        </script>
    {% endif %}

    <div class="application" id="application">

    {% block application_content %}

        {% include 'snippets/wizards/welcome-beta/welcome-beta.html' %}

    {% endblock application_content %}
    </div>
  </section>

  {% block application_footer %}{% endblock application_footer %}

{% block web_item_importer %}
    {% cache 86400 base_web_item_importer perms.core.can_import_web_items %}
        {% include 'snippets/selector/import-web-items-trigger.html' %}
    {% endcache %}

{% endblock web_item_importer %}
{% endblock body %}

{% block extrajs_footer %}

    {% cache 86400 base_extrajs_footer_immutable %}

    {{ block.super }}

    <script type="text/javascript"
        src="//cdnjs.cloudflare.com/ajax/libs/raven.js/1.0.8/raven.min.js"></script>

    <script type="text/javascript">
        Raven.config('{% sentry_public_dsn %}').install();
    </script>

    {# NOTE: JS inclusion order matters. #}
    {% django_js jquery=false %}

    {% comment %}
        This version is not the same as on Github
            https://github.com/jeresig/jquery.hotkeys

        Syntax is different, as commented at
            https://github.com/tzuryby/jquery.hotkeys/issues/1#issuecomment-5930686

        <script type="text/javascript"
            src="http://cdn.jsdelivr.net/jquery.hotkeys/0.8b/jquery.hotkeys.js"></script>

        Thus, we use MouseTrap, which is simpler and allows combinations.


        For Later, perhaps:
        <script type="text/javascript"
            src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

        No jealous:
        http://www.asp.net/ajaxlibrary/CDNjQueryMobile132.ashx
    {% endcomment %}
    <script type="text/javascript"
        src="http://cdn.jsdelivr.net/underscorejs/1.5.1/underscore-min.js"></script>
    <script type="text/javascript"
        src="http://cdn.jsdelivr.net/mousetrap/1.4.2/mousetrap.min.js"></script>
    <script type="text/javascript"
        src="http://cdn.jsdelivr.net/hammerjs/1.0.5/hammer.min.js"></script>
    <script type="text/javascript"
        src="http://cdn.jsdelivr.net/pnotify/1.2/jquery.pnotify.js"></script>
    <script type="text/javascript"
        src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script type="text/javascript"
        src="http://cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min.js"></script>

    {% import_django_select2_js %}

    {% compressed_js 'vendor-all' %}
    {#{% compressed_js 'core' %}#}

    {% endcache %}

    {% csrf_token %}

    {% cache 86400 base_extrajs_footer_lang LANGUAGE_CODE %}

    <script type="text/javascript">
        {# This must stay here (in the template) to get the server-side language. #}
        //moment.lang('{{ LANGUAGE_CODE }}');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            crossDomain: false,
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type)) {
                    xhr.setRequestHeader("X-CSRFToken",
                        $("input[name='csrfmiddlewaretoken']").val());
                }
            }
        });

        // —————————————————————————————————————————— common keyboard shortcuts

        // “Add Item”, “Import Item”
        Mousetrap.bind(['a i', 'i i'], function() {
            $("#import-web-item-trigger").click();
            return false;
        });

        // “Goto Selector”, “Goto Sources”
        Mousetrap.bind(['g s'], function() {
            notify("{% trans "Returning to source selector…" %}");
            document.location = "{% url 'source_selector' %}";
            return false;
        });

    </script>

    {% endcache %}

{% endblock extrajs_footer %}
