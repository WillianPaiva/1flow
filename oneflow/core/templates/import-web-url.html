{% extends 'home.html' %}
{% block title %}{% trans "Import a web item" %}{% endblock title %}
{% block body_id %}import-web-item{% endblock body_id %}

{% block application_content %}

<div class="spacer50"></div>

<div class="row-fluid">
	<div class="hero-unit span6 offset3">

{% url 'article_conversion_status' article.id as poll_url %}
{% url 'read_all_feed' mongodb_user.web_import_subscription.id as import_url %}
{% if article %}


	<h1>{% trans "Success" %}</h1>
	<div class="spacer25"></div>

	<p>{% blocktrans %}
		Item imported. Waiting for its conversion <i class="icon-spinner icon-spin icon-large"></i></p><p>

		You can <a href="javascript:window.open('', '_self', '');window.close()">close this window/tab</a> or open <a href="{{ import_url }}">your imported items</a> and wait there.</p><p>


		Just remember that <strong>the item will not be visible until converted</strong>.</p><div class="spacer25"></div><p class="muted"><small>

		Note: videos, images and other kind of non-textual content are not handled yet, and will fail to convert. Thus, you will not see them at all. We apologize for this non-smart technical restriction. <br />
		<strong>Your landing on this very page guarantees that the item has been imported in your data set</strong>. You <strong>will</strong> be able to display it correctly in the not-so-distant future.</small>

	{% endblocktrans %}</p>

	<script type="text/javascript">

		$(document).ready(function(){
			function poll_article_status() {

				$.get("{{ poll_url }}", function(data) {
					if (data.indexOf('http') == 0) {
						document.location = data;
					}
				});

				setTimeout(poll_article_status, 1000);
			}

			setTimeout(poll_article_status, 1000);
		});

	</script>

{% else %}

	<h1>{% trans "Bummer!" %}</h1>
	<div class="spacer25"></div>

	<p>{% blocktrans %}

		<strong>We were not able to import the item at address <em>{{ url }}</em></strong>. We are sorry for that.</p><p>

		Developers have been notified of the failure, and will investigate the problem if the error is legitimate.</p><p>

		<a href="javascript:window.open('', '_self', '');window.close()">Close this window/tab.</a>

	{% endblocktrans %}</p>

{% endif %}

	</div>

{% if mongodb_user.is_staff_or_superuser_and_enabled and article %}
</div>
<div class="row-fluid">
	<div class="hero-unit span8 offset2 centered">

		<p>{% trans "Admin stuff:" %}
				<a href="{{ settings.NONREL_ADMIN }}article/{{ article.id }}"
					target="_blank">{{ article.title }} â€“ {{ article.id }}</a>
		</p>

	</div>
{% endif %}

</div>
{% endblock application_content %}
